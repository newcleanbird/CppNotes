# decltype 类型推导
decltype 关键字：decltype 是“declare type”的缩写，译为“声明类型”。和 auto 的功能一样，都用来在编译时期进行自动类型推导。
如果希望从表达式中推断出要定义的变量的类型，但是不想用该表达式的值初始化变量，这时就不能再用 auto。decltype 作用是选择并返回操作数的数据类型。

## decltype 和 auto
```cpp
auto var = val1 + val2; 
decltype(val1 + val2) var1 = 0; 
```
- auto 根据 = 右边的初始值 val1 + val2 推导出变量的类型，并将该初始值赋值给变量 var；decltype 根据 val1 + val2 表达式推导出变量的类型，变量的初始值和与表达式的值无关。

- auto 要求变量必须初始化，因为它是根据初始化的值推导出变量的类型，而 decltype 不要求，定义变量的时候可初始化也可以不初始化。

## 基本原理
1. 编译时推导：decltype的类型推导发生在编译时期，它不会引起运行时开销，并且不会实际计算表达式的值，仅分析表达式来确定其类型。

2. 表达式分析：decltype接受一个表达式作为参数，然后返回该表达式的类型。这使得decltype能够推导出更广泛类型的表达式，包括那些不能直接用于初始化变量的表达式。

## 推导规则
1. 变量或成员访问：如果decltype的参数是一个未加括号的变量名或类成员访问表达式，那么decltype(exp)的结果就是去掉顶层const和volatile的exp的类型。例如，如果x是一个int类型的变量，则decltype(x)是int。

2. 函数调用：如果exp是一个函数调用表达式，那么decltype(exp)的结果就是该函数的返回类型。

3. 左值与右值：对于其他类型的表达式，如果exp是一个左值（可寻址的表达式，如变量名），则decltype(exp)的结果是该左值的引用类型（例如，对于变量x，decltype((x))给出的是int&）。如果exp是一个右值，则结果是其非引用类型。

4. 括号的影响：当表达式被括号包围时，即使原表达式是左值，也会被当作右值处理，除非表达式自身就是左值引用。例如，decltype((expr))通常会返回expr类型的右值引用，除非expr已经是一个左值引用。

## 应用场景
- 复杂类型表达式的类型获取：在需要显式指定复杂类型或模板参数时，decltype可以帮助直接从表达式推导类型，避免手动书写类型。

- 返回类型后置语法：在C++11中，结合auto关键字，decltype可以用来实现函数返回类型的延迟声明，即所谓的返回类型后置语法（trailing return type）。这对于模板函数尤其有用，当函数返回类型依赖于模板参数时。

总之，decltype是一种强大的类型推导工具，它在理解和运用现代C++编程中扮演着重要角色，尤其是在涉及复杂类型推导和泛型编程的场景下。