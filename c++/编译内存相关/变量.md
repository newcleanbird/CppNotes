# 变量

## 从作用域区分变量的种类

- 全局变量和局部变量
  
### 全局变量

#### 全局变量定义

- 在所有函数外部定义的变量（通常是在程序的头部），称为全局变量。

#### 全局变量作用域

- 全局作用域:
  - 本文件内:从"定义变量的位置"开始到本"源文件"结束。
  - 所有文件内：使用extern等关键字声明全局作用域（只需要在一个源文件中定义，就可以作用于所有的源文件）
  - 全局变量可以被所有定义在全局变量之后的函数访问。
  - 声明在前，定义在后就可以。因此最好先声明，再在最下面定义实现。

#### 全局变量生命周期

- 从程序运行期一直存在，从程序开始到程序结束。
- 在程序的全部执行过程中都占用存储单元，而不是仅在需要时才开辟单元。

#### 全局变量使用注意

- 屏蔽：
  - 在同一个源文件中，如果全局变量和局部变量同名，则在局部变量的作用范围内，全局变量被屏蔽，即不起作用。
- 只能定义一次：
  - 如果再两个文件中都定义了相同名字的全局变量，则连接错误：变量重定义。
- 使用不宜过多：
  - 全局变量不宜过多，应限制使用，因为过多会使各个含有全局变量的函数在执行时可能改变其值，程序容易出错。而能修改全局变量的语句又很多，这使调试程序变得困难。

#### 全局变量全局变量重定义问题

1. 原因

   - 外部链接性
   首先明确一点全局变量是具备 外部链接性的，何为外部连接性呢？外部链接性的变量通常简称为外部变量，作用域为整个文件。可以在文件中位于外部变量定义的后面的任意函数中使用它，因此也称为全局变量。

2. 头文件的作用
  当.c或者.cpp引用头文件的时候，无非是将头文件的内容拷贝入本.c或者.cpp。当我们在头文件中定义一个全局变量，而又在多个.c或者.cpp文件中引用它，就会引发全局变量重定义。话不多说看图：本图中B.cpp和C.cpp都引用了a.h等价于在B.cpp和C.cpp中都声明了全局变量。而全局变量的作用域是整个文件，故而出现了全局变量重定义的问题。

3. 解决办法：
   1. 定义和声明
      1. 变量定义: 用于为变量分配存储空间，还可为变量指定初始值。程序中，变量有且仅有一个定义。
      2. 变量声明: 用于向程序表明变量的类型和名字。
      3. 注意
        - 变量在使用前就要被定义或者声明。
        - 在一个程序中，变量只能定义一次，却可以声明多次。
        - 定义分配存储空间，而声明不会。
        - C++程序通常由许多文件组成，为了让多个文件访问相同的变量，C++区分了声明和定义。
   2. 解决经验
      1. 永远不要在.h文件中定义变量,这样容易导致重复定义错误。
      2. 尽量使用static关键字把变量定义限制于该源文件作用域，除非变量被设计成全局的。
      3. 可以在头文件中声明一个变量，在用的时候包含这个头文件就声明了这个变量。
      4. 头文件(.h)中 是对于该模块接口的声明，接口包括该模块提供给其它模块调用的外部函数及外部全局变量，对这些变量和函数都需在.h中文件中冠以extern关键字声明。

   3. 使用static解决全局变量初始化带来的重复定义问题。
       1. 全局变量范围只能限定在文件里，不会外联到整个模块和项目中。
       2. 变量只在源文件中有效。
       - 解决函数重定义：引入 inline关键字修饰函数

### 局部变量

#### 局部变量定义

在“函数内部”或一个“代码块内部”声明的变量，称为局部变量。

- 使用 { } 括起来的一段代码可称为代码块。

#### 局部变量生命周期

程序运行处的==局部作用域==。(块作用域，函数作用域，类作用域，程序全局作用域)

- 局部变量只在函数调用时存在，一旦调用结束，局部变量就被销毁。

#### 局部变量作用域

只在当前函数内部和代码段内部。

- 函数的形参也是局部变量。
- 主函数无法使用其他函数中定义的局部变量。同理其他函数也无法使用主函数中的变量
- 不同的函数可使用同名的局部变量，它们互不干扰。

### 静态全局变量：static int = 1

#### 静态全局变量定义

在所有函数外部使用"static"定义：static int i = 0;

- static关键字，const关键字（注意C/C++意义不同）

先来解释一下C++中const全局变量的作用域:

1. C++中的const修饰的全局常量具有跟static相同的特性(有条件的，const放在只读静态存储区)，即它们只能作用于本编译模块中，可是const可以与extern连用来声明该常量可以作用于其他编译模块中.
2. C++中的const正常情况下是看成编译期的常量,编译器并不为const分配空间,只是在编译的时候将期值保存在名字表中,并在适当的时候折合在代码中.而在C中,const是一个不能被改变的普通变量。

#### 静态全局变量生命周期

程序运行期一直存在，从程序开始到程序结束；

- static没有改变生命周期。

#### 静态全局变量作用域

文件作用域（只在被定义的文件中可见：static的一个作用就是隐藏）

- 使用static改变了作用域，只能在被定义文件中可见。

#### 静态全局变量内存分布

- 全局（静态存储区）。

#### 静态全局变量注意点

- 只被定义一次。

### 静态局部变量

#### 静态局部变量定义

局部作用域中用static定义。

#### 静态局部变量生命周期

在静态存储区，整个程序运行期间一直存在。

#### 静态局部变量作用域

局部作用域（只在局部作用域可见，超过其作用域便无法被引用）

#### 静态局部变量内存分布

全局（静态存储区）。

#### 静态局部变量注意点

只能被初始化一次，多线程中需要加锁保护。

### 静态成员变量

#### 静态成员变量定义

static修饰的成员变量

- 静态成员变量既可以通过对象名访问，也可以通过类名访问，但要遵循 private、protected 和 public 关键字的访问权限限制。 当通过对象名访问时，对于不同的对象，访问的是同一份内存。

#### 静态成员变量初始化

- 类外：类型 类名::静态成员变量名 = 赋值;

#### 静态成员变量访问：(三种访问方式)

1. 类名::静态成员变量
2. 对象名.静态成员变量
3. 对象指针->静态成员变量

#### 静态成员变量生命周期

和静态变量一样，程序运行期一直存在；

#### 静态成员变量作用域

文件作用域

#### 静态成员变量内存分布

全局(静态存储区)

### 类的成员函数里定义的静态变量

#### 类的成员函数里定义的静态变量定义

类的成员函数中定义static变量。

#### 类的成员函数里定义的静态变量初始化

未经初始化的全局静态变量会被自动初始化为0（自动对象的值是任意的，除非他被显式初始化）

#### 类的成员函数里定义的静态变量特点

和类的静态变量没有差别，所有的成员函数都共享这个静态变量

#### 类的成员函数里定义的静态变量生命周期

在静态存储区，整个程序运行期间一直存在。

#### 类的成员函数里定义的静态变量作用域

作用域仍为局部作用域，当定义它的函数或者语句块结束的时候，作用域结束。但是当局部静态变量离开作用域后，并没有销毁，而是仍然驻留在内存当中，只不过我们不能再对它进行访问，直到该函数再次被调用，并且值不变；

#### 类的成员函数里定义的静态变量内存分布

全局(静态存储区)

## 变量的区别

### 全局变量、局部变量、静态全局变量、静态局部变量的区别

- 全局变量就是定义在函数外的变量。
- 局部变量就是函数内定义的变量。
- 静态变量就是加了static的变量。 例如：static int value = 1

### 各自存储的位置

- 全局变量，存储在常量区（静态存储区）。
- 静态变量，存储在常量区（静态存储区）。
- 局部变量, 存储在栈区。

注意: 因为静态变量都在静态存储区（常量区），所以下次调用函数的时候还是能取到原来的值。

### 各自初始化的值

- 局部变量, 存储在栈区。局部变量一般是不初始化的，
- 局部变量, 存储在栈区。全局变量和静态变量，都是初始化为0的，有一个初始值。
- 局部变量, 存储在栈区。如果是类变量，会调用默认构造函数初始化。

### 从作用域看

C++ 变量根据定义的位置的不同的生命周期，具有不同的作用域，作用域可分为 6 种：全局作用域，局部作用域，语句作用域，类作用域，命名空间作用域和文件作用域。

- 全局变量：具有全局作用域。全局变量只需在一个源文件中定义，就可以作用于所有的源文件。当然，其他不包含全局变量定义的源文件需要用extern 关键字再次声明这个全局变量。会一直存在到程序结束。
- 静态全局变量：全局作用域+文件作用域，所以无法在其他文件中使用。它与全局变量的区别在于如果程序包含多个文件的话，它作用于定义它的文件里，不能作用到其它文件里，即被static 关键字修饰过的变量具有文件作用域。这样即使两个不同的源文件都定义了相同名字的静态全局变量，它们也是不同的变量。
- 局部变量：具有局部作用域。比如函数的参数，函数内的局部变量等等；它是自动对象（auto），在程序运行期间不是一直存在，而是只在函数执行期间存在，函数的一次调用执行结束后，变量被销毁，其所占用的内存也被收回。
- 静态局部变量：具有局部作用域。它只被初始化一次， 直到程序结束。自从第一次被初始化直到程序运行结束都一直存在，它和全局变量的区别在于全局变量对所有的函数都是可见的，而静态局部变量只对定义自己的函数体始终可见。

### 从分配内存空间看

- 静态存储区：全局变量，静态局部变量，静态全局变量。
- 栈：局部变量。

### 各自的应用场景

- 局部变量就是我们经常用的，进入函数，逐个构造，最后统一销毁。
- 全局变量主要是用来给不同的文件之间进行通信。
- 静态变量：只在本文件中使用，局部静态变量在函数内起作用，可以作为一个计数器。

```cpp
   void func(){
     static int count;
     count ++;
   }
   int main(int argc, char** argv){
     for(int i = 0; i < 10; i++)
       func();
   }
```

### 说说静态变量在代码执行的什么阶段进行初始化？

```cpp
static int value  //静态变量初始化语句
```

对于C语言： 静态变量和全局变量均在编译期进行初始化，即初始化发生在任何代码执行之前。
对于C++： 静态变量和全局变量仅当首次被使用的时候才进行初始化。

助记： 如果你使用过C/C++你会发现，C语言要求在程序的最开头声明全部的变量，而C++则可以随时使用随时声明；这个规律是不是和答案类似呢？

### 全局变量定义在头文件中有什么问题？

如果在头文件中定义全局变量，当该头文件被多个文件 include 时，该头文件中的全局变量就会被定义多次，导致重复定义，因此不能再头文件中定义全局变量。
